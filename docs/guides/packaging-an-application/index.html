<!doctype html><html lang="en-US"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="preload" as="font" href="https://package-operator.run/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin><link rel="preload" as="font" href="https://package-operator.run/fonts/vendor/jost/jost-v4-latin-500.woff2" type="font/woff2" crossorigin><link rel="preload" as="font" href="https://package-operator.run/fonts/vendor/jost/jost-v4-latin-700.woff2" type="font/woff2" crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel="stylesheet" href="https://package-operator.run/main.6657cf90267b27935484651e58ec85e85ae3cccf0be203d18e06d5696ad402253a66671da93983f7f42502a86269963cff7a59f604f765d2cf0e851546de740c.css" integrity="sha512-ZlfPkCZ7J5NUhGUeWOyF6FrjzM8L4gPRjgbVaWrUAiU6ZmcdqTmD9/QlAqhiaZY8/3pZ9gT3ZdLPDoUVRt50DA==" crossorigin="anonymous"><noscript><style>img.lazyload{display:none}</style></noscript><meta name="robots" content="index, follow"><meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Packaging an Application - Package Operator</title><meta name="description" content="In this guide, you will deploy a simple nginx web server, using the Package Operator - Package API.
During this guide you will:
Create a manifest.yaml file Assign Kubernetes objects to PKO phases Take advantage of templates Setup test cases for templates Build and Validate the Package Operator package To complete this guide you will need:
A Kubernetes cluster with Package Operator installed The kubectl-package CLI plugin A container-registry to push images to"><link rel="canonical" href="https://package-operator.run/docs/guides/packaging-an-application/"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://package-operator.run/#/schema/organization/1","name":"Doks","url":"https://package-operator.run/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://package-operator.run/#/schema/image/1","url":"https://package-operator.run/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://package-operator.run/#/schema/image/1"}},{"@type":"WebSite","@id":"https://package-operator.run/#/schema/website/1","url":"https://package-operator.run/","name":"Package Operator","description":"Operator for packaging and managing a collection of arbitrary Kubernetes objects to install software on one or multiple clusters.","publisher":{"@id":"https://package-operator.run/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://package-operator.run/docs/guides/packaging-an-application/","url":"https://package-operator.run/docs/guides/packaging-an-application/","name":"Packaging an Application","description":"","isPartOf":{"@id":"https://package-operator.run/#/schema/website/1"},"about":{"@id":"https://package-operator.run/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://package-operator.run/docs/guides/packaging-an-application/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://package-operator.run/docs/guides/packaging-an-application/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://package-operator.run/docs/guides/packaging-an-application/"]}]},{"@type":"BreadcrumbList","@id":"https://package-operator.run/docs/guides/packaging-an-application/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://package-operator.run/","url":"https://package-operator.run/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://package-operator.run/docs/","url":"https://package-operator.run/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://package-operator.run/docs/guides/","url":"https://package-operator.run/docs/guides/","name":"Guides"}},{"@type":"ListItem","position":4,"item":{"@id":"https://package-operator.run/docs/guides/packaging-an-application/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://package-operator.run/#/schema/article/1","headline":"Packaging an Application","description":"","isPartOf":{"@id":"https://package-operator.run/docs/guides/packaging-an-application/"},"mainEntityOfPage":{"@id":"https://package-operator.run/docs/guides/packaging-an-application/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"https://package-operator.run/#/schema/person/2"},"publisher":{"@id":"https://package-operator.run/#/schema/organization/1"},"image":{"@id":"https://package-operator.run/docs/guides/packaging-an-application/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://package-operator.run/#/schema/person/2","name":"Henk Verlinde","sameAs":["https://twitter.com/henkverlinde","https://www.linkedin.com/in/henkverlinde/","https://github.com/h-enk"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://package-operator.run/docs/guides/packaging-an-application/#/schema/image/2","url":null,"contentUrl":null,"caption":"Packaging an Application"}]}]}</script><meta name="theme-color" content="#fff"><link rel="icon" href="https://package-operator.run/favicon.ico" sizes="any"><link rel="icon" type="image/svg+xml" href="https://package-operator.run/%20favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="https://package-operator.run/%20apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://package-operator.run/%20favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://package-operator.run/%20favicon-16x16.png"><meta name="go-import" content="package-operator.run/package-operator git https://github.com/package-operator/package-operator.git"><meta name="go-import" content="package-operator.run git https://github.com/package-operator/package-operator.git"></head><body class="docs single"><div class="sticky-top"><div class="header-bar"></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href="/" aria-label="Package Operator">Package Operator</a>
<button class="btn btn-link order-0 ms-auto d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel"><div class="header-bar"></div><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasExampleLabel">Browse docs</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><aside class="doks-sidebar mt-n3"><nav id="doks-docs-nav" aria-label="Tertiary navigation"><h3 class="h6 text-uppercase mb-2">Getting Started</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/introduction/">Introduction</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/architecture/">Architecture</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/requirements/">Requirements</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/installation/">Installation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/api-reference/">API Reference</a></li></ul><h3 class="h6 text-uppercase mb-2">Guides</h3><ul class="list-unstyled"><li><a class="docs-link active" href="https://package-operator.run/docs/guides/packaging-an-application/">Packaging an Application</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-operator/">Packaging an Operator</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/image-digests/">Working with image digests</a></li></ul><h3 class="h6 text-uppercase mb-2">Concepts</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/concepts/reconciliation/">Object Reconciliation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/probes/">Probes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/object-template/">Object Templates</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/phases/">Phases</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/scopes/">Scopes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/revisions/">Revisions</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-format/">Package Format</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/big-packages/">Big Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/hypershift-integration/">HyperShift Integration</a></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDoks" aria-controls="offcanvasDoks" aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex="-1" id="offcanvasDoks" data-bs-backdrop="true" aria-labelledby="offcanvasDoksLabel"><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id="offcanvasDoksLabel"><a class="text-dark" href="/">Package Operator</a></h2><button type="button" class="btn-close text-reset me-2" data-bs-dismiss="offcanvas" aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item"><a class="nav-link ps-0 py-1 active" href="/docs/getting_started/introduction">Docs</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">Get Started
<span class="dropdown-caret"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby="navbarDropdownMenuLink"><li><a class="dropdown-item" href="/docs/getting_started/installation">Installation</a></li><li><a class="dropdown-item" href="/docs/guides">Guides</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id="search" class="form-control is-search" type="search" placeholder="Search docs..." aria-label="Search docs..." autocomplete="off"><div id="suggestions" class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class="nav-item"><a class="nav-link social-link" href="https://github.com/package-operator/package-operator"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id="mode" class="btn btn-link" type="button" aria-label="Toggle user interface mode">
<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class="container-xxl"><aside class="doks-sidebar"><nav id="doks-docs-nav" class="collapse d-lg-none" aria-label="Tertiary navigation"><h3 class="h6 text-uppercase mb-2">Getting Started</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/introduction/">Introduction</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/architecture/">Architecture</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/requirements/">Requirements</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/installation/">Installation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/api-reference/">API Reference</a></li></ul><h3 class="h6 text-uppercase mb-2">Guides</h3><ul class="list-unstyled"><li><a class="docs-link active" href="https://package-operator.run/docs/guides/packaging-an-application/">Packaging an Application</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-operator/">Packaging an Operator</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/image-digests/">Working with image digests</a></li></ul><h3 class="h6 text-uppercase mb-2">Concepts</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/concepts/reconciliation/">Object Reconciliation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/probes/">Probes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/object-template/">Object Templates</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/phases/">Phases</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/scopes/">Scopes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/revisions/">Revisions</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-format/">Package Format</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/big-packages/">Big Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/hypershift-integration/">HyperShift Integration</a></li></ul></nav></aside></div><div class="wrap container-xxl" role="document"><div class="content"><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav id="sidebar-default" class="docs-links" aria-label="Main navigation"><h3 class="h6 text-uppercase mb-2">Getting Started</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/introduction/">Introduction</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/architecture/">Architecture</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/requirements/">Requirements</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/installation/">Installation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/api-reference/">API Reference</a></li></ul><h3 class="h6 text-uppercase mb-2">Guides</h3><ul class="list-unstyled"><li><a class="docs-link active" href="https://package-operator.run/docs/guides/packaging-an-application/">Packaging an Application</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-operator/">Packaging an Operator</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/image-digests/">Working with image digests</a></li></ul><h3 class="h6 text-uppercase mb-2">Concepts</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/concepts/reconciliation/">Object Reconciliation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/probes/">Probes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/object-template/">Object Templates</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/phases/">Phases</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/scopes/">Scopes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/revisions/">Revisions</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-format/">Package Format</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/big-packages/">Big Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/hypershift-integration/">HyperShift Integration</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class="d-xl-none"><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#onThisPage" aria-controls="doks-docs-nav" aria-expanded="false" aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class="collapse" id="onThisPage"><div class="card card-body mt-3 py-1"><div class="page-links"><nav id="TableOfContents"><ul><li><a href="#1-start">1. Start</a><ul><li><a href="#writing-a-packagemanifest">Writing a PackageManifest</a></li><li><a href="#assigning-objects-to-phases">Assigning objects to phases</a></li><li><a href="#build--validate">Build & Validate</a></li><li><a href="#deploy">Deploy</a></li></ul></li><li><a href="#2-templates">2. Templates</a><ul><li><a href="#go-templates">Go Templates</a></li><li><a href="#testing-templates">Testing Templates</a></li><li><a href="#upgradedeploy">Upgrade/Deploy</a></li></ul></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id="TableOfContents"><ul><li><a href="#1-start">1. Start</a><ul><li><a href="#writing-a-packagemanifest">Writing a PackageManifest</a></li><li><a href="#assigning-objects-to-phases">Assigning objects to phases</a></li><li><a href="#build--validate">Build & Validate</a></li><li><a href="#deploy">Deploy</a></li></ul></li><li><a href="#2-templates">2. Templates</a><ul><li><a href="#go-templates">Go Templates</a></li><li><a href="#testing-templates">Testing Templates</a></li><li><a href="#upgradedeploy">Upgrade/Deploy</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Packaging an Application</h1><p class="lead"></p><nav class="d-xl-none" aria-label="Quaternary navigation"><div class="d-xl-none"><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#onThisPage" aria-controls="doks-docs-nav" aria-expanded="false" aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class="collapse" id="onThisPage"><div class="card card-body mt-3 py-1"><div class="page-links"><nav id="TableOfContents"><ul><li><a href="#1-start">1. Start</a><ul><li><a href="#writing-a-packagemanifest">Writing a PackageManifest</a></li><li><a href="#assigning-objects-to-phases">Assigning objects to phases</a></li><li><a href="#build--validate">Build & Validate</a></li><li><a href="#deploy">Deploy</a></li></ul></li><li><a href="#2-templates">2. Templates</a><ul><li><a href="#go-templates">Go Templates</a></li><li><a href="#testing-templates">Testing Templates</a></li><li><a href="#upgradedeploy">Upgrade/Deploy</a></li></ul></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id="TableOfContents"><ul><li><a href="#1-start">1. Start</a><ul><li><a href="#writing-a-packagemanifest">Writing a PackageManifest</a></li><li><a href="#assigning-objects-to-phases">Assigning objects to phases</a></li><li><a href="#build--validate">Build & Validate</a></li><li><a href="#deploy">Deploy</a></li></ul></li><li><a href="#2-templates">2. Templates</a><ul><li><a href="#go-templates">Go Templates</a></li><li><a href="#testing-templates">Testing Templates</a></li><li><a href="#upgradedeploy">Upgrade/Deploy</a></li></ul></li></ul></nav></div></nav><p>In this guide, you will deploy a simple nginx web server, using the Package
Operator - <a href="/docs/getting_started/api-reference/#package">Package API</a>.</p><p>During this guide you will:</p><ul><li>Create a <code>manifest.yaml</code> file</li><li>Assign Kubernetes objects to PKO phases</li><li>Take advantage of templates</li><li>Setup test cases for templates</li><li>Build and Validate the Package Operator package</li></ul><p>To complete this guide you will need:</p><ul><li>A Kubernetes cluster with Package Operator installed</li><li>The <code>kubectl-package</code> CLI plugin</li><li>A container-registry to push images to<br>(optional when using tars and kind load)</li></ul><p>All files used during this guide are available in the
<a href="https://github.com/package-operator/examples">package-operator/examples</a> repository.</p><h2 id="1-start">1. Start <a href="#1-start" class="anchor" aria-hidden="true">#</a></h2><p><em>Please refer to the files in <code>/1_applications/1_start</code> for this step.</em></p><p>When packaging an application for Package Operator, you will need 2 things:</p><ol><li>One or more Kubernetes manifests (e.g. <code>deployment.yaml</code>)</li><li>A <a href="/docs/getting_started/api-reference/#packagemanifest">PackageManifest</a> object
in a <code>manifest.yaml</code> file</li></ol><h3 id="writing-a-packagemanifest">Writing a PackageManifest <a href="#writing-a-packagemanifest" class="anchor" aria-hidden="true">#</a></h3><p>Like with any Kubernetes object Group Version Kind contains the version information:</p><pre><code class="language-yaml">apiVersion: manifests.package-operator.run/v1alpha1
kind: PackageManifest
</code></pre><hr><p>Metadata contains the name of this package:</p><pre><code class="language-yaml">metadata:
  name: nginx
</code></pre><hr><p>Packages may be cluster-scope, namespace-scope or both.<br>This controls whether you can install this package via <code>Package</code> or
<code>ClusterPackage</code> API.<br>Namespaced packages can not contain cluster-scoped objects, like <code>Namespaces</code>.</p><pre><code class="language-yaml">spec:
  scopes:
  - Namespaced
</code></pre><hr><p>Phases are needed when you need a distinct order in your rollout or teardown.</p><p>Examples:</p><ul><li>Ensure an application is completely upgraded before reconfiguring the LB</li><li>Run a database migration before bringing up the new Deployment</li><li>Ensure CRDs are Established before deploying your Operator</li></ul><pre><code class="language-yaml">spec:
  phases:
  - name: deploy
</code></pre><hr><p>Probes define how Package Operator interrogates objects under management for status.<br>PKO will only continue into the next Phase if all objects passed their availabilityProbe.</p><pre><code class="language-yaml">spec:
  availabilityProbes:
  - probes:
    - condition:
        type: Available
        status: &quot;True&quot;
    - fieldsEqual:
        fieldA: .status.updatedReplicas
        fieldB: .status.replicas
    selector:
      kind:
        group: apps
        kind: Deployment
</code></pre><h3 id="assigning-objects-to-phases">Assigning objects to phases <a href="#assigning-objects-to-phases" class="anchor" aria-hidden="true">#</a></h3><p>Package Operators needs to know in which phase objects belong.<br>To assign an object to a phase, simply add an annotation:</p><pre><code class="language-yaml">metadata:
  annotations:
    package-operator.run/phase: deploy
</code></pre><h3 id="build--validate">Build & Validate <a href="#build--validate" class="anchor" aria-hidden="true">#</a></h3><p>If you just want to validate the local package contents, use:</p><pre><code class="language-sh">$ kubectl package validate 1_applications/1_start

# example:
Error: Package validation errors:
- Missing package-operator.run/phase Annotation in deployment.yaml#0
</code></pre><hr><p>To inspect the parsed hierarchy of your package, use:</p><pre><code class="language-sh">$ kubectl package tree 1_applications/1_start

# example:
nginx
Package namespace/name
└── Phase deploy
    └── apps/v1, Kind=Deployment /nginx-deployment
</code></pre><hr><p>And finally to build your package as a container image use:</p><pre><code class="language-sh"># -o will directly output a `podman/docker load` compatible tar.gz
# of your container image.
# Use this flag if you don't want to push images to a container registry.
# To give a demonstration, you can use nginx:local as your image url here.
$ kubectl package build -t &lt;your-image-url-goes-here&gt; -o nginx.tar.gz 1_applications/1_start
# example: load image into kind nodes:
$ kind load image-archive nginx.tar.gz

# Alternatively push images directly to a registry.
# Assumes you are already logged into a registry via `podman/docker login`
$ kubectl package build -t &lt;your-image-url-goes-here&gt; --push 1_applications/1_start
</code></pre><div class="alert alert-doks d-flex" role="alert"><div class="flex-shrink-1 alert-icon"></div><div class="w-100">If you load the image to a local registry (e.g. with
'minikube image load' or 'kind load'), specify a tag different than 'latest'
(e.g. 'test' or 'v1'), otherwise Package Operator won't be able to load it.</div></div><h3 id="deploy">Deploy <a href="#deploy" class="anchor" aria-hidden="true">#</a></h3><p>Now that you have build your first Package Operator package, we can deploy it!<br>You will find the <code>Package</code>-object template in the examples checkout under
1_applications/package.yaml. Don&rsquo;t forget to change the package url so it<br>corresponds to the one used when building the package.</p><p>If the package specified a configuration set, its values are to be specified in<br>a config section within the spec. If a config entry has a default specified in<br>the package manifest it may be overridden here. If the package requires values<br>that are not defaulted and missing here, the package installation will fail.</p><pre><code class="language-yaml">apiVersion: package-operator.run/v1alpha1
kind: Package
metadata:
  name: my-nginx
spec:
  image: &lt;your-package-url-goes-here&gt;
  config:
    nginxImage: &quot;nginx:1.23.3&quot;
</code></pre><pre><code class="language-sh">$ kubectl create -f 1_applications/package.yaml
package.package-operator.run/my-nginx created

# wait for package to be loaded and installed:
$ kubectl get package -w
NAME       STATUS        AGE
my-nginx   Progressing   11s
my-nginx   Available     13s

# success!
$ kubectl get po
NAME                               READY   STATUS    RESTARTS   AGE
nginx-deployment-cd55c47f5-szvh7   1/1     Running   0          79s
</code></pre><h2 id="2-templates">2. Templates <a href="#2-templates" class="anchor" aria-hidden="true">#</a></h2><p><em>Please refer to the files in <code>/1_applications/2_templates</code> for this step.</em></p><p>Next we want to make sure that the package can be installed multiple times into
the same namespace. To accomplish this, we have to make the package more dynamic!</p><h3 id="go-templates">Go Templates <a href="#go-templates" class="anchor" aria-hidden="true">#</a></h3><p>By renaming <code>deployment.yaml</code> into <code>deployment.yaml.gotmpl</code>, we can enable<br><a href="https://pkg.go.dev/text/template">Go template</a> support. Files suffixed with<br><code>.gotmpl</code> will be processed by the Go template engine before the YAML manifests<br>are parsed.</p><p><a href="/docs/getting_started/api-reference/#templatecontext">TemplateContext</a> is<br>documented as part of the API. It always contains information like package<br>metadata that can be used to reduce reduncancies.</p><pre><code class="language-yaml">app.kubernetes.io/instance: &quot;{{.package.metadata.name}}&quot;
</code></pre><p>Additionally, a config section may be added to packages, which requires said<br>config to be specified within the package manifest as<br><a href="https://spec.openapis.org/oas/v3.1.0">OpenAPI spec</a>. It is recommended require<br>value that are always needed for package deployment and set defaults if appropriate.</p><p>To inspect the parsed hierarchy of your package when using a config section you<br>must provide a configuration file with the required values:</p><pre><code class="language-yaml">nginxImage: &quot;nginx:1.23.3&quot;
</code></pre><pre><code class="language-sh">kubectl package tree 1_applications/2_templates/ --config-path config.yaml
</code></pre><p>Alternatively the config section of a named test template within the manifest<br>can be used:</p><pre><code class="language-sh">kubectl package tree 1_applications/2_templates/ --config-testcase namespace-scope
</code></pre><h3 id="testing-templates">Testing Templates <a href="#testing-templates" class="anchor" aria-hidden="true">#</a></h3><p>Using a template engine with yaml files can quickly lead to unexpected results.<br>To aid with testing, Package Operator includes a simple package testing framework.</p><p>Template tests may be configured as part of the <code>PackageManifest</code>, by specifying
the TemplateContext data to test the template process with.</p><p>For each template test, Package Operator will auto-generate fixtures into a <code>.test-fixtures</code>
folder when running <code>kubectl package validate</code> or <code>build</code> and compare the output
of successive template operations against these fixtures.</p><pre><code class="language-yaml">test:
  template:
  - name: namespace-scope
    context:
      package:
        metadata:
          name: my-cool-name
          namespace: test-ns
</code></pre><hr><p>Now make a change to the template and validate the package again:</p><pre><code class="language-yaml">#...
metadata:
  name: &quot;{{.package.metadata.Name}}-deploy&quot;
#...
</code></pre><pre><code class="language-sh">$ kubectl package validate 1_applications/2_templates
Error: Package validation errors:
- Test &quot;namespace-scope&quot;: File mismatch against fixture in deployment.yaml.gotmpl:
  --- FIXTURE/deployment.yaml
  +++ ACTUAL/deployment.yaml
  @@ -1,7 +1,7 @@
   apiVersion: apps/v1
   kind: Deployment
   metadata:
  -  name: &quot;my-cool-name&quot;
  +  name: &quot;my-cool-name-deploy&quot;
     labels:
       app.kubernetes.io/name: nginx
       app.kubernetes.io/instance: &quot;my-cool-name&quot;
</code></pre><p>To continue building the package, either reset your change to the template, edit
the fixture or delete the <code>.test-fixtures</code> folder and regenerate all fixtures by
running the validate command again.</p><h3 id="upgradedeploy">Upgrade/Deploy <a href="#upgradedeploy" class="anchor" aria-hidden="true">#</a></h3><p>Build your package again using a different tag or image name:</p><pre><code class="language-sh">kubectl package build -t &lt;your-image-url-goes-here&gt; --push 1_applications/2_templates
</code></pre><hr><p>Edit the <code>Package</code> object on the cluster to change the <code>image:</code>.</p><pre><code class="language-sh">kubectl edit package
</code></pre><hr><p>Watch the change being rolled out:</p><pre><code class="language-sh">kubectl get package -w
NAME       STATUS      AGE
my-nginx   Available   65m
my-nginx   Progressing   65m
my-nginx   Progressing   65m
my-nginx   Available     65m
</code></pre><hr><p>The name of the deployment is now using the name of the Package object, so it&rsquo;s
safe to create multiple instances of the same package.<br>Just change the name of <code>1_applications/package.yaml</code> and deploy your package again:</p><pre><code class="language-sh">$ kubectl get package
NAME          STATUS      AGE
my-nginx      Available   69m
other-nginx   Available   6s

$ kubectl get deploy
NAME          READY   UP-TO-DATE   AVAILABLE   AGE
my-nginx      1/1     1            1           6m25s
other-nginx   1/1     1            1           117s
</code></pre><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a class="ms-auto" href="/docs/guides/packaging-an-operator/"><div class="card my-1"><div class="card-body py-2">Packaging an Operator &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class="container-xxl"><div class="row"><div class="col-lg-8 order-last order-lg-first"><ul class="list-inline"><li class="list-inline-item">Powered by <a class="text-muted" href="https://gohugo.io/">Hugo</a> and <a class="text-muted" href="https://getdoks.org/">Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class="list-inline"></ul></div></div></div></footer><script src="/js/bootstrap.min.44fc78ffe68ed681865871fdec9750ca44c6febe429bf0779d114896edde0f92b92891b983ef933484a02a2c7ceb3d1fa6392c39179350ad04197a153a2db970.js" integrity="sha512-RPx4/+aO1oGGWHH97JdQykTG/r5Cm/B3nRFIlu3eD5K5KJG5g++TNISgKix86z0fpjksOReTUK0EGXoVOi25cA==" crossorigin="anonymous" defer></script>
<script src="/js/highlight.min.0ca52c0c3265c6a30e142e56d1d279a5abdc4854e537bd615d480b6d9d2eef537681e36cfc97d563c0f7bb1b61273d51616606da5cbdca3d59339dcf1691bbed.js" integrity="sha512-DKUsDDJlxqMOFC5W0dJ5pavcSFTlN71hXUgLbZ0u71N2geNs/JfVY8D3uxthJz1RYWYG2ly9yj1ZM53PFpG77Q==" crossorigin="anonymous" defer></script>
<script src="/main.min.69d35aeb30daacb0dce36b2e5bb73d1c7f537e4fa2576cc91b016c5f795053df9b5e664d87fe45fe755bd2fe67f6be177bfb017bac93a0e97bd34420dd63eff3.js" integrity="sha512-adNa6zDarLDc42suW7c9HH9Tfk+iV2zJGwFsX3lQU9+bXmZNh/5F/nVb0v5n9r4Xe/sBe6yToOl700Qg3WPv8w==" crossorigin="anonymous" defer></script>
<script src="https://package-operator.run/index.min.9ccc76a0a78f4269b8061b297cc1dd43f916bc9f87273ef43e4dd25732bdb758ea8fd2ba3a3fe588385ee419e10ce4dfce801f4591d914bf1f29c0e4b76c88d9.js" integrity="sha512-nMx2oKePQmm4BhspfMHdQ/kWvJ+HJz70Pk3SVzK9t1jqj9K6Oj/liDhe5BnhDOTfzoAfRZHZFL8fKcDkt2yI2Q==" crossorigin="anonymous" defer></script></body></html>