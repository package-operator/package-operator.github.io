<!doctype html><html lang="en-US"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="preload" as="font" href="https://package-operator.run/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin><link rel="preload" as="font" href="https://package-operator.run/fonts/vendor/jost/jost-v4-latin-500.woff2" type="font/woff2" crossorigin><link rel="preload" as="font" href="https://package-operator.run/fonts/vendor/jost/jost-v4-latin-700.woff2" type="font/woff2" crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel="stylesheet" href="/main.5617abf2cfd1af306980669eca1a56870267b24a18c2da225ccda5bcd5b8dc85eeb4408153a673bb7fb261d181b874ff6d5779a8b83ce1e0186ed925addcdb06.css" integrity="sha512-Vher8s/RrzBpgGaeyhpWhwJnskoYwtoiXM2lvNW43IXutECBU6Zzu3+yYdGBuHT/bVd5qLg84eAYbtklrdzbBg==" crossorigin="anonymous"><noscript><style>img.lazyload{display:none}</style></noscript><meta name="robots" content="index, follow"><meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Revisions - Package Operator</title>
<meta name="description" content="stateDiagram-v2 direction LR state &amp;quot;Revision 1&amp;quot; as rev1 state &amp;quot;Revision 2&amp;quot; as rev2 state &amp;quot;Revision 3&amp;quot; as rev3 [*] --&amp;gt; rev1 rev1 --&amp;gt; rev2 rev2 --&amp;gt; rev3 rev3 --&amp;gt; [*] Revisions are iterations and changes of a deployment over time. To support zero-downtime deployments, even if something goes wrong, Package Operator can manage multiple active revisions at the same time. This strategy is also often referred to as &amp;ldquo;A/B deployment&amp;rdquo; or &amp;ldquo;canary deployment&amp;rdquo;."><link rel="canonical" href="https://package-operator.run/docs/concepts/revisions/"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://package-operator.run/#/schema/organization/1","name":"Doks","url":"https://package-operator.run/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"https://package-operator.run/#/schema/image/1","url":"https://package-operator.run/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://package-operator.run/#/schema/image/1"}},{"@type":"WebSite","@id":"https://package-operator.run/#/schema/website/1","url":"https://package-operator.run/","name":"Package Operator","description":"Operator for packaging and managing a collection of arbitrary Kubernetes objects to install software on one or multiple clusters.","publisher":{"@id":"https://package-operator.run/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://package-operator.run/docs/concepts/revisions/","url":"https://package-operator.run/docs/concepts/revisions/","name":"Revisions","description":"","isPartOf":{"@id":"https://package-operator.run/#/schema/website/1"},"about":{"@id":"https://package-operator.run/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://package-operator.run/docs/concepts/revisions/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://package-operator.run/docs/concepts/revisions/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://package-operator.run/docs/concepts/revisions/"]}]},{"@type":"BreadcrumbList","@id":"https://package-operator.run/docs/concepts/revisions/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://package-operator.run/","url":"https://package-operator.run/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://package-operator.run/docs/","url":"https://package-operator.run/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://package-operator.run/docs/concepts/","url":"https://package-operator.run/docs/concepts/","name":"Concepts"}},{"@type":"ListItem","position":4,"item":{"@id":"https://package-operator.run/docs/concepts/revisions/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://package-operator.run/#/schema/article/1","headline":"Revisions","description":"","isPartOf":{"@id":"https://package-operator.run/docs/concepts/revisions/"},"mainEntityOfPage":{"@id":"https://package-operator.run/docs/concepts/revisions/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"https://package-operator.run/#/schema/person/2"},"publisher":{"@id":"https://package-operator.run/#/schema/organization/1"},"image":{"@id":"https://package-operator.run/docs/concepts/revisions/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://package-operator.run/#/schema/person/2","name":"Henk Verlinde","sameAs":["https://twitter.com/henkverlinde","https://www.linkedin.com/in/henkverlinde/","https://github.com/h-enk"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://package-operator.run/docs/concepts/revisions/#/schema/image/2","url":null,"contentUrl":null,"caption":"Revisions"}]}]}</script><meta name="theme-color" content="#fff"><link rel="icon" href="https://package-operator.run/favicon.ico" sizes="any"><link rel="icon" type="image/svg+xml" href="https://package-operator.run/%20favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="https://package-operator.run/%20apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://package-operator.run/%20favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://package-operator.run/%20favicon-16x16.png"><meta name="go-import" content="package-operator.run git https://github.com/package-operator/package-operator.git"></head><body class="docs single"><div class="sticky-top"><div class="header-bar"></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href="/" aria-label="Package Operator">Package Operator
</a><button class="btn btn-link order-0 ms-auto d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel"><div class="header-bar"></div><div class="offcanvas-header"><h5 class="offcanvas-title" id="offcanvasExampleLabel">Browse docs</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><aside class="doks-sidebar mt-n3"><nav id="doks-docs-nav" aria-label="Tertiary navigation"><h3 class="h6 text-uppercase mb-2">Getting Started</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/introduction/">Introduction</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/architecture/">Architecture</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/requirements/">Requirements</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/installation/">Installation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/api-reference/">API Reference</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/template-reference/">Template Reference</a></li></ul><h3 class="h6 text-uppercase mb-2">Guides</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-application/">Packaging an Application</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-operator/">Packaging an Operator</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/image-digests/">Working with image digests</a></li></ul><h3 class="h6 text-uppercase mb-2">Concepts</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/concepts/reconciliation/">Object Reconciliation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-configuration/">Package Configuration</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/probes/">Probes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/object-template/">Object Templates</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/phases/">Phases</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/scopes/">Scopes</a></li><li><a class="docs-link active" href="https://package-operator.run/docs/concepts/revisions/">Revisions</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-format/">Package Format</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/big-packages/">Big Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/multi-component-packages/">Multi-Component Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/hypershift-integration/">HyperShift Integration</a></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDoks" aria-controls="offcanvasDoks" aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex="-1" id="offcanvasDoks" data-bs-backdrop="true" aria-labelledby="offcanvasDoksLabel"><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id="offcanvasDoksLabel"><a class="text-dark" href="/">Package Operator</a></h2><button type="button" class="btn-close text-reset me-2" data-bs-dismiss="offcanvas" aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item"><a class="nav-link ps-0 py-1 active" href="/docs/getting_started/introduction">Docs</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">Get Started
<span class="dropdown-caret"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby="navbarDropdownMenuLink"><li><a class="dropdown-item" href="/docs/getting_started/installation">Installation</a></li><li><a class="dropdown-item" href="/docs/guides">Guides</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id="search" class="form-control is-search" type="search" placeholder="Search docs..." aria-label="Search docs..." autocomplete="off"><div id="suggestions" class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class="nav-item"><a class="nav-link social-link" href="https://github.com/package-operator/package-operator"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id="mode" class="btn btn-link" type="button" aria-label="Toggle user interface mode">
<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class="container-xxl"><aside class="doks-sidebar"><nav id="doks-docs-nav" class="collapse d-lg-none" aria-label="Tertiary navigation"><h3 class="h6 text-uppercase mb-2">Getting Started</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/introduction/">Introduction</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/architecture/">Architecture</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/requirements/">Requirements</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/installation/">Installation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/api-reference/">API Reference</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/template-reference/">Template Reference</a></li></ul><h3 class="h6 text-uppercase mb-2">Guides</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-application/">Packaging an Application</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-operator/">Packaging an Operator</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/image-digests/">Working with image digests</a></li></ul><h3 class="h6 text-uppercase mb-2">Concepts</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/concepts/reconciliation/">Object Reconciliation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-configuration/">Package Configuration</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/probes/">Probes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/object-template/">Object Templates</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/phases/">Phases</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/scopes/">Scopes</a></li><li><a class="docs-link active" href="https://package-operator.run/docs/concepts/revisions/">Revisions</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-format/">Package Format</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/big-packages/">Big Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/multi-component-packages/">Multi-Component Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/hypershift-integration/">HyperShift Integration</a></li></ul></nav></aside></div><div class="wrap container-xxl" role="document"><div class="content"><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav id="sidebar-default" class="docs-links" aria-label="Main navigation"><h3 class="h6 text-uppercase mb-2">Getting Started</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/introduction/">Introduction</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/architecture/">Architecture</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/requirements/">Requirements</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/installation/">Installation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/api-reference/">API Reference</a></li><li><a class="docs-link" href="https://package-operator.run/docs/getting_started/template-reference/">Template Reference</a></li></ul><h3 class="h6 text-uppercase mb-2">Guides</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-application/">Packaging an Application</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/packaging-an-operator/">Packaging an Operator</a></li><li><a class="docs-link" href="https://package-operator.run/docs/guides/image-digests/">Working with image digests</a></li></ul><h3 class="h6 text-uppercase mb-2">Concepts</h3><ul class="list-unstyled"><li><a class="docs-link" href="https://package-operator.run/docs/concepts/reconciliation/">Object Reconciliation</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-configuration/">Package Configuration</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/probes/">Probes</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/object-template/">Object Templates</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/phases/">Phases</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/scopes/">Scopes</a></li><li><a class="docs-link active" href="https://package-operator.run/docs/concepts/revisions/">Revisions</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/package-format/">Package Format</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/big-packages/">Big Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/multi-component-packages/">Multi-Component Packages</a></li><li><a class="docs-link" href="https://package-operator.run/docs/concepts/hypershift-integration/">HyperShift Integration</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class="d-xl-none"><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#onThisPage" aria-controls="doks-docs-nav" aria-expanded="false" aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class="collapse" id="onThisPage"><div class="card card-body mt-3 py-1"><div class="page-links"><nav id="TableOfContents"><ul><li><a href="#revision-lifecycle">Revision Lifecycle</a></li><li><a href="#rollout-handling">Rollout Handling</a><ul><li><a href="#in-place-updates">In-Place Updates</a></li><li><a href="#ab-updates">A/B Updates</a></li><li><a href="#intermediate-failed-revisions">Intermediate (Failed) Revisions</a></li></ul></li><li><a href="#internals">Internals</a><ul><li><a href="#objectset-to-objectset-handover">ObjectSet to ObjectSet Handover</a></li></ul></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id="TableOfContents"><ul><li><a href="#revision-lifecycle">Revision Lifecycle</a></li><li><a href="#rollout-handling">Rollout Handling</a><ul><li><a href="#in-place-updates">In-Place Updates</a></li><li><a href="#ab-updates">A/B Updates</a></li><li><a href="#intermediate-failed-revisions">Intermediate (Failed) Revisions</a></li></ul></li><li><a href="#internals">Internals</a><ul><li><a href="#objectset-to-objectset-handover">ObjectSet to ObjectSet Handover</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Revisions</h1><p class="lead"></p><nav class="d-xl-none" aria-label="Quaternary navigation"><div class="d-xl-none"><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#onThisPage" aria-controls="doks-docs-nav" aria-expanded="false" aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class="collapse" id="onThisPage"><div class="card card-body mt-3 py-1"><div class="page-links"><nav id="TableOfContents"><ul><li><a href="#revision-lifecycle">Revision Lifecycle</a></li><li><a href="#rollout-handling">Rollout Handling</a><ul><li><a href="#in-place-updates">In-Place Updates</a></li><li><a href="#ab-updates">A/B Updates</a></li><li><a href="#intermediate-failed-revisions">Intermediate (Failed) Revisions</a></li></ul></li><li><a href="#internals">Internals</a><ul><li><a href="#objectset-to-objectset-handover">ObjectSet to ObjectSet Handover</a></li></ul></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id="TableOfContents"><ul><li><a href="#revision-lifecycle">Revision Lifecycle</a></li><li><a href="#rollout-handling">Rollout Handling</a><ul><li><a href="#in-place-updates">In-Place Updates</a></li><li><a href="#ab-updates">A/B Updates</a></li><li><a href="#intermediate-failed-revisions">Intermediate (Failed) Revisions</a></li></ul></li><li><a href="#internals">Internals</a><ul><li><a href="#objectset-to-objectset-handover">ObjectSet to ObjectSet Handover</a></li></ul></li></ul></nav></div></nav><pre><code class="language-mermaid">stateDiagram-v2
direction LR
  state &quot;Revision 1&quot; as rev1
  state &quot;Revision 2&quot; as rev2
  state &quot;Revision 3&quot; as rev3
  [*] --&gt; rev1
  rev1 --&gt; rev2
  rev2 --&gt; rev3
  rev3 --&gt; [*]
</code></pre><p>Revisions are iterations and changes of a deployment over time. To support zero-downtime
deployments, even if something goes wrong, Package Operator can manage multiple
active revisions at the same time. This strategy is also often referred to as
&ldquo;A/B deployment&rdquo; or &ldquo;canary deployment&rdquo;.</p><p>A revision is represented by the <code>ObjectSet</code>/<code>ClusterObjectSet</code> APIs.</p><p>While revision are ordered on a time axis, Package Operator makes no assumptions
on the contents of each revisions. This means that Revision 3 could contain the
same spec as Revision 1, rolling back changes introduced by Revision 2.</p><h2 id="revision-lifecycle">Revision Lifecycle <a href="#revision-lifecycle" class="anchor" aria-hidden="true">#</a></h2><pre><code class="language-mermaid">stateDiagram-v2
direction LR
  state &quot;Not Ready&quot; as not_ready
  [*] --&gt; Pending
  Pending --&gt; Available
  Available --&gt; not_ready
  Pending --&gt; not_ready
  not_ready --&gt; Available
  Available --&gt; Archived
  not_ready --&gt; Archived
  Archived --&gt; [*]
</code></pre><ul><li><strong>Pending</strong><br>Intermediate state before the controller posted its first update.</li><li><strong>Available</strong><br>All availability probes are successful.</li><li><strong>Not Ready</strong><br>One or more availability probes are unsuccessful.</li><li><strong>Archived</strong><br>(Cluster)ObjectSet is shutdown and only acts as a revision tombstone for rollbacks.</li></ul><p>In addition to these major lifecycle states, (Cluster)ObjectSets may be <strong>Paused</strong>,
stopping reconciliation, while still reporting status.
This can be useful for testing and debugging.</p><h2 id="rollout-handling">Rollout Handling <a href="#rollout-handling" class="anchor" aria-hidden="true">#</a></h2><p>Depending on the contents of the new revision, objects are eventually either:</p><ul><li><strong>Patched</strong><br>If the object still part of the new revision, it will be handed over to the next
revision.</li><li><strong>Deleted</strong><br>If the object is not part of the new revision, it will be deleted when the old
revision is archived.</li></ul><h3 id="in-place-updates">In-Place Updates <a href="#in-place-updates" class="anchor" aria-hidden="true">#</a></h3><pre><code class="language-mermaid">flowchart LR
  subgraph Revision 1
    deploy1[&quot;Deployment &lt;b&gt;my-deployment&lt;/b&gt;&lt;br&gt;image: my-image:rev1&quot;]
  end
  subgraph Revision 2
    deploy2[&quot;Deployment &lt;b&gt;my-deployment&lt;/b&gt;&lt;br&gt;image: my-image:rev2&quot;]
  end
  deploy1--patched object--&gt;deploy2
</code></pre><p>&ldquo;In-Place&rdquo; updates happen when a new revision contains an object with the same name
and type as the previous revision. Objects are handed over to a new revision and
patched as needed.</p><p>When all objects have been handed over to a new revision, the previous revision
is automatically <strong>archived</strong>.</p><div class="alert alert-doks d-flex" role="alert"><div class="flex-shrink-1 alert-icon"></div><div class="w-100">Updating in-place may not provide any safety net.<br>If the Update
fails, your deployment may face downtime.</div></div><h3 id="ab-updates">A/B Updates <a href="#ab-updates" class="anchor" aria-hidden="true">#</a></h3><pre><code class="language-mermaid">flowchart LR
  subgraph Revision 1
    deploy1[&quot;Deployment &lt;b&gt;my-deployment-v1&lt;/b&gt;&lt;br&gt;image: my-image:rev1&quot;]
  end
  subgraph Revision 2
    deploy2[&quot;Deployment &lt;b&gt;my-deployment-v2&lt;/b&gt;&lt;br&gt;image: my-image:rev2&quot;]
  end
  deploy1-. indirect successor .-&gt;deploy2
</code></pre><p>A/B updates happen when a new revision does not contain an object with the same
name and type as a previous revision. A new object is created in the new revision
without affecting the old object.</p><p>The old revision is only archived when the new revision has completely finished
its rollout and is &ldquo;Available&rdquo;.</p><h3 id="intermediate-failed-revisions">Intermediate (Failed) Revisions <a href="#intermediate-failed-revisions" class="anchor" aria-hidden="true">#</a></h3><pre><code class="language-mermaid">flowchart LR
  subgraph rev1[Revision 1]
    cm1[&quot;ConfigMap &lt;b&gt;my-config&lt;/b&gt;&lt;br&gt;data: {key: value-v1}&quot;]
    deploy1[&quot;Deployment &lt;b&gt;my-deployment-v1&lt;/b&gt;&lt;br&gt;image: my-image:rev1&quot;]
  end
  subgraph rev2[Revision 2]
    cm2[&quot;ConfigMap &lt;b&gt;my-config&lt;/b&gt;&lt;br&gt;data: {key: value-v2}&quot;]
    deploy2[&quot;Deployment &lt;b&gt;my-deployment-v2&lt;/b&gt;&lt;br&gt;image: my-image:does-not-exist&quot;]
  end
  subgraph rev3[Revision 3]
    cm3[&quot;ConfigMap &lt;b&gt;my-config&lt;/b&gt;&lt;br&gt;data: {key: value-v3}&quot;]
    deploy3[&quot;Deployment &lt;b&gt;my-deployment-v3&lt;/b&gt;&lt;br&gt;image: my-image:rev3&quot;]
  end
  style rev2 fill:#ffbabd,stroke:#9f7b7d
  deploy1--&gt;deploy2
  deploy2--&gt;deploy3
  cm1-.-&gt;cm2
  cm2-.-&gt;cm3
</code></pre><p>Under normal circumstances at max 2 Revisions can be active during rollout. An old
and a new revision.</p><p>If a revision fails to become available due to e.g. misconfiguration and a new revision
supersedes it, multiple intermediate revisions might be active until the latest
revision becomes available.</p><p>Intermediate revisions will only be cleaned up if:</p><ul><li>Latest revision becomes available</li><li>Revision is not reconciling any objects anymore</li><li>Latest revision is not containing any object still actively reconciled by an intermediate</li></ul><div class="alert alert-doks d-flex" role="alert"><div class="flex-shrink-1 alert-icon"></div><div class="w-100">This behavior is necessary, so Package Operator can ensure the
safe handover of objects between revisions.</div></div><p>In the example above, the ConfigMap &ldquo;my-config&rdquo; is handed over from revision 1 to
revision 2 and in the end to revision 3.</p><p>As soon as revision 3 takes ownership of the ConfigMap, the failed intermediate
revision 2 can be archived, as &ldquo;my-deployment-v2&rdquo; no longer exists in revision 3
and is thus safe to delete.</p><h2 id="internals">Internals <a href="#internals" class="anchor" aria-hidden="true">#</a></h2><h3 id="objectset-to-objectset-handover">ObjectSet to ObjectSet Handover <a href="#objectset-to-objectset-handover" class="anchor" aria-hidden="true">#</a></h3><pre><code class="language-yaml">apiVersion: package-operator.run/v1alpha1
kind: ObjectSet
metadata:
  name: v1
spec:
  phases:
  - name: phase-1
    objects: [{name: child-1}]
  - name: phase-2
    objects: [{name: child-2}]
---
apiVersion: package-operator.run/v1alpha1
kind: ObjectSet
metadata:
  name: v2
spec:
  phases:
  - name: phase-1
    objects: [{name: child-1}]
  - name: phase-2
    objects: [{name: child-2}]
  previous:
  - name: v1
    kind: ObjectSet
    group: package-operator.run
</code></pre><pre><code class="language-mermaid">sequenceDiagram
autonumber
  participant v1 as ObjectSet v1 Reconciler
  participant api as kube-apiserver
  participant v2 as ObjectSet v2 Reconciler

  loop Reconciliation
    v1-&gt;&gt;api: reconcile/update child-1 .spec
    v1-&gt;&gt;api: reconcile/update child-2 .spec
  end

  Note over v2: phase-1 starts
  v2-&gt;&gt;api: Take ownership of child-1 and&lt;br&gt; reconcile/update .spec
  par ObjectSet v1 Reconciler
    api-)v1: child-1 Update event
    activate v1
    v1-&gt;&gt;api: reconcile/update child-2 .spec
    deactivate v1
  and ObjectSet v2 Reconciler
    api-)v2: child-1 Update event
    activate v2
    v2-&gt;&gt;api: reconcile/update child-1 .spec
    deactivate v2
  end

  Note over v1,v2: Until phase-1 completes
  loop Reconciliation
    v2-&gt;&gt;api: reconcile/update child-1 .spec
    v1-&gt;&gt;api: reconcile/update child-2 .spec
  end

  Note over v2: phase-2 starts
  v2-&gt;&gt;api: reconcile/update child-1 .spec
  activate v2
  v2-&gt;&gt;api: Take ownership of child-2 and&lt;br&gt; reconcile/update .spec
  par ObjectSet v1 Reconciler
    api-)+v1: child-1 Update event
    deactivate v1
  and ObjectSet v2 Reconciler
    api-)v2: child-1 Update event
    activate v2
    v2-&gt;&gt;api: reconcile/update child-1 .spec
    v2-&gt;&gt;api: reconcile/update child-2 .spec
    deactivate v2
  end
</code></pre><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href="/docs/concepts/scopes/"><div class="card my-1"><div class="card-body py-2">&larr; Scopes</div></div></a><a class="ms-auto" href="/docs/concepts/package-format/"><div class="card my-1"><div class="card-body py-2">Package Format &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class="container-xxl"><div class="row"><div class="col-lg-8 order-last order-lg-first"><ul class="list-inline"><li class="list-inline-item">Powered by <a class="text-muted" href="https://gohugo.io/">Hugo</a> and <a class="text-muted" href="https://getdoks.org/">Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class="list-inline"></ul></div></div></div></footer><script src="/js/bootstrap.min.5a6f7686a75311832f9f1feed99f35019d824bf8b16fb67dd245d71ba2ac41ef01d924cad506ad7a1432fb579700210c4704c92242a4f97bea71b5f5ac14e506.js" integrity="sha512-Wm92hqdTEYMvnx/u2Z81AZ2CS/ixb7Z90kXXG6KsQe8B2STK1QatehQy+1eXACEMRwTJIkKk+XvqcbX1rBTlBg==" crossorigin="anonymous" defer></script><script src="/js/highlight.min.eb2f55f52b517c6e269b72349cdda6f5c513e2bdff58c4134d976f876dae6fefea946ed4ac2918de9a36d6089a43419dffba733e45619dae0b171b92617f0d9c.js" integrity="sha512-6y9V9StRfG4mm3I0nN2m9cUT4r3/WMQTTZdvh22ub+/qlG7UrCkY3po21giaQ0Gd/7pzPkVhna4LFxuSYX8NnA==" crossorigin="anonymous" defer></script><script src="/main.min.afbb0b0dcecd029124b52bb6e7de568d50969dc458ca534c87fcb4793533d9c4dfea20c94c1ac0ff906f55ece5ca90dabb2434b9cea6c68d839bcd7745774d8e.js" integrity="sha512-r7sLDc7NApEktSu2595WjVCWncRYylNMh/y0eTUz2cTf6iDJTBrA/5BvVezlypDauyQ0uc6mxo2Dm813RXdNjg==" crossorigin="anonymous" defer></script><script src="/js/mermaid.min.7afeaf4250b403ead34b14a4804d40603853795306554f5ca42f21d2333d71f2b9bc866d50d070a6ebe57ded3a177c5098be4b203f0aad441b2bb5280568ee0d.js" integrity="sha512-ev6vQlC0A+rTSxSkgE1AYDhTeVMGVU9cpC8h0jM9cfK5vIZtUNBwpuvlfe06F3xQmL5LID8KrUQbK7UoBWjuDQ==" crossorigin="anonymous" defer></script><script src="https://package-operator.run/index.min.66a5c769e606394e0fe77342ddf41cc2552c06a022413c186c502e6a46a05e85f07358edb0b7b187c89b34c449dabc4fb0cff782c452b06094bb68f8a7807d71.js" integrity="sha512-ZqXHaeYGOU4P53NC3fQcwlUsBqAiQTwYbFAuakagXoXwc1jtsLexh8ibNMRJ2rxPsM/3gsRSsGCUu2j4p4B9cQ==" crossorigin="anonymous" defer></script></body></html>